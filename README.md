# AIå¤šæ™ºèƒ½ä½“ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

ä¸€ä¸ªåŸºäºWebçš„å¤šæ™ºèƒ½ä½“èŠå¤©å®¤åº”ç”¨ï¼Œæ”¯æŒåˆ›å»ºå¤šä¸ªAIæ™ºèƒ½ä½“è§’è‰²ï¼Œå¹¶åœ¨èŠå¤©å®¤ä¸­è¿›è¡Œè‡ªåŠ¨è®¨è®ºã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å¤šæ™ºèƒ½ä½“èŠå¤©å®¤ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºå…·æœ‰ä¸åŒè§’è‰²å’Œæ€§æ ¼çš„AIæ™ºèƒ½ä½“ï¼Œå¹¶åœ¨ä¸»é¢˜èŠå¤©å®¤ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–è®¨è®ºã€‚ç³»ç»Ÿé€šè¿‡è°ƒç”¨é˜¿é‡Œäº‘DashScope APIå®ç°çœŸå®çš„AIå¯¹è¯åŠŸèƒ½ï¼Œå¹¶é€šè¿‡WebSocketæä¾›å®æ—¶æ¶ˆæ¯æ¨é€ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½ä½“ç®¡ç†**: åˆ›å»ºå’Œç®¡ç†å¤šä¸ªAIæ™ºèƒ½ä½“è§’è‰²ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“éƒ½æœ‰ç‹¬ç‰¹çš„åç§°ã€è§’è‰²å®šä½å’Œæ€§æ ¼æè¿°
- **èŠå¤©å®¤ç³»ç»Ÿ**: åˆ›å»ºä¸»é¢˜èŠå¤©å®¤ï¼Œé€‰æ‹©å‚ä¸çš„æ™ºèƒ½ä½“ï¼Œå¯åŠ¨è‡ªåŠ¨åŒ–è®¨è®º
- **å®æ—¶é€šä¿¡**: ä½¿ç”¨WebSocketå®ç°å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œè§‚å¯Ÿæ™ºèƒ½ä½“çš„è®¨è®ºè¿‡ç¨‹

### ğŸ¨ ç•Œé¢ç‰¹æ€§
- **ç°ä»£åŒ–UI**: é‡‡ç”¨æ¸å˜èƒŒæ™¯å’Œæ¯›ç»ç’ƒæ•ˆæœï¼Œç•Œé¢ç¾è§‚ç°ä»£
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯è®¿é—®
- **å®æ—¶æ›´æ–°**: èŠå¤©æ¶ˆæ¯å®æ—¶æ˜¾ç¤ºï¼Œæ”¯æŒè®¨è®ºçŠ¶æ€ç®¡ç†
- **ç”¨æˆ·å‹å¥½**: ç›´è§‚çš„æ“ä½œç•Œé¢ï¼Œæ˜“äºä½¿ç”¨

## æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯
- **è¯­è¨€**: Go 1.21+
- **Webæ¡†æ¶**: Gin Web Framework
- **å®æ—¶é€šä¿¡**: Gorilla WebSocket
- **æ•°æ®å­˜å‚¨**: MySQLæ•°æ®åº“
- **APIé›†æˆ**: é˜¿é‡Œäº‘DashScope API
- **é…ç½®ç®¡ç†**: YAMLé…ç½®æ–‡ä»¶æ”¯æŒ

### å‰ç«¯æŠ€æœ¯
- **HTML5 + CSS3**: ç°ä»£åŒ–ç•Œé¢è®¾è®¡
- **åŸç”ŸJavaScript**: æ— éœ€é¢å¤–æ¡†æ¶ä¾èµ–
- **WebSocket**: å®æ—¶é€šä¿¡æ”¯æŒ

## ç³»ç»Ÿæ¶æ„

- **åç«¯**: Go + Gin + GORM + MySQL
- **å‰ç«¯**: HTML + CSS + JavaScript
- **æ•°æ®åº“**: MySQL 8.0
- **éƒ¨ç½²**: Docker + Docker Compose

## ç›®å½•ç»“æ„

```
AIagents2.0/
â”œâ”€â”€ backend/                 # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ internal/           # å†…éƒ¨åŒ…
â”‚   â”‚   â”œâ”€â”€ config/        # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database/      # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ model/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ router/        # è·¯ç”±å¤„ç†
â”‚   â”œâ”€â”€ main.go            # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ config.yaml        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ go.mod             # Goæ¨¡å—æ–‡ä»¶
â”‚   â””â”€â”€ go.sum             # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.html         # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ style.css          # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ app.js             # JavaScripté€»è¾‘
â”œâ”€â”€ nginx/                  # Nginxé…ç½®
â”‚   â””â”€â”€ nginx.conf         # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ mysql/                  # MySQLåˆå§‹åŒ–
â”‚   â””â”€â”€ init/              # åˆå§‹åŒ–è„šæœ¬
â”‚       â””â”€â”€ 01-init.sql    # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ Dockerfile             # Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml     # Docker Composeé…ç½®
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md              # æœ¬æ–‡æ¡£
```

## é…ç½®è¯´æ˜

### 1. YAMLé…ç½®æ–‡ä»¶ (backend/config.yaml)

ç³»ç»Ÿæ”¯æŒé€šè¿‡YAMLæ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œä¸»è¦é…ç½®é¡¹åŒ…æ‹¬ï¼š

```yaml
# æœåŠ¡å™¨é…ç½®
server:
  port: 8080          # åç«¯æœåŠ¡ç«¯å£
  host: "0.0.0.0"     # ç›‘å¬åœ°å€

# æ•°æ®åº“é…ç½®
database:
  type: "mysql"       # æ•°æ®åº“ç±»å‹
  host: "localhost"   # æ•°æ®åº“ä¸»æœº
  port: 3306          # æ•°æ®åº“ç«¯å£
  username: "root"    # æ•°æ®åº“ç”¨æˆ·å
  password: "root"    # æ•°æ®åº“å¯†ç 
  dbname: "ai_agents" # æ•°æ®åº“åç§°
  charset: "utf8mb4"  # å­—ç¬¦é›†
  timezone: "Local"   # æ—¶åŒº
  max_idle_conns: 10  # æœ€å¤§ç©ºé—²è¿æ¥æ•°
  max_open_conns: 100 # æœ€å¤§æ‰“å¼€è¿æ¥æ•°

# APIé…ç½®
api:
  api_key: "your-api-key"     # DashScope API Key
  base_url: "https://..."     # APIåŸºç¡€URL
  model: "qwen-plus"          # é»˜è®¤æ¨¡å‹
  endpoint: "https://..."     # APIç«¯ç‚¹

# æ—¥å¿—é…ç½®
log:
  level: "info"               # æ—¥å¿—çº§åˆ«
  file: "logs/app.log"        # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  console: true               # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°
```

### 2. ç¯å¢ƒå˜é‡é…ç½® (.env)

Docker Composeæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
# MySQLæ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=your_root_password
MYSQL_DATABASE=ai_agents
MYSQL_USER=aiuser
MYSQL_PASSWORD=your_mysql_password
MYSQL_PORT=3306

# æœåŠ¡ç«¯å£é…ç½®
BACKEND_PORT=8080
FRONTEND_PORT=80

# æ—¶åŒºé…ç½®
TZ=Asia/Shanghai
```

## éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šDocker Compose éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿LinuxæœåŠ¡å™¨å·²å®‰è£…ï¼š
- Docker (ç‰ˆæœ¬ 20.10+)
- Docker Compose (ç‰ˆæœ¬ 2.0+)

```bash
# å®‰è£…Docker (Ubuntu/Debian)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

#### 2. é¡¹ç›®éƒ¨ç½²

```bash
# 1. å…‹éš†æˆ–ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨
git clone <your-repo-url> ai-agents
cd ai-agents

# æˆ–è€…ç›´æ¥ä¸Šä¼ é¡¹ç›®æ–‡ä»¶åˆ°æœåŠ¡å™¨
scp -r ./AIagents2.0 user@your-server:/opt/ai-agents

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/ai-agents

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®æ–‡ä»¶

# 4. ä¿®æ”¹åç«¯é…ç½®æ–‡ä»¶
nano backend/config.yaml

# é‡è¦ï¼šä¿®æ”¹æ•°æ®åº“è¿æ¥é…ç½®
# å°† host æ”¹ä¸º "mysql"ï¼ˆDockeræœåŠ¡åï¼‰
# ä¿®æ”¹ç”¨æˆ·åå¯†ç ç­‰é…ç½®

# 5. æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up -d

# 6. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 7. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### 3. é…ç½®æ–‡ä»¶ä¿®æ”¹ç¤ºä¾‹

ä¿®æ”¹ `backend/config.yaml` ä¸­çš„æ•°æ®åº“é…ç½®ï¼š

```yaml
database:
  host: "mysql"              # ä½¿ç”¨DockeræœåŠ¡å
  port: 3306
  username: "aiuser"         # ä¸.envä¸­çš„MYSQL_USERä¸€è‡´
  password: "aipassword"     # ä¸.envä¸­çš„MYSQL_PASSWORDä¸€è‡´
  dbname: "ai_agents"        # ä¸.envä¸­çš„MYSQL_DATABASEä¸€è‡´
```

#### 4. ç«¯å£é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®æš´éœ²çš„ç«¯å£ï¼š

```bash
# å‰ç«¯è®¿é—®ç«¯å£
FRONTEND_PORT=80

# åç«¯APIç«¯å£
BACKEND_PORT=8080

# MySQLç«¯å£ï¼ˆå¦‚éœ€å¤–éƒ¨è®¿é—®ï¼‰
MYSQL_PORT=3306
```

#### 5. è®¿é—®åº”ç”¨

- å‰ç«¯ç•Œé¢ï¼š`http://your-server-ip:80`
- åç«¯APIï¼š`http://your-server-ip:8080`
- å¥åº·æ£€æŸ¥ï¼š`http://your-server-ip:8080/health`

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…Go (ç‰ˆæœ¬ 1.21+)
wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# å®‰è£…MySQL
sudo apt update
sudo apt install mysql-server

# å®‰è£…Nginx
sudo apt install nginx
```

#### 2. é…ç½®æ•°æ®åº“
```bash
# åˆ›å»ºMySQLæ•°æ®åº“
mysql -u root -p
CREATE DATABASE ai_agents CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

3. **é…ç½®åç«¯**
```bash
cd backend
# ä¿®æ”¹config.yamlæ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
nano config.yaml
```

4. **å®‰è£…ä¾èµ–å¹¶è¿è¡Œ**
```bash
# å®‰è£…Goä¾èµ–
go mod tidy

# è¿è¡Œåç«¯æœåŠ¡
go run main.go
```

5. **è®¿é—®åº”ç”¨**
æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8080`

## å¸¸ç”¨è¿ç»´å‘½ä»¤

### Docker Compose å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f [service_name]

# è¿›å…¥å®¹å™¨
docker-compose exec backend sh
docker-compose exec mysql mysql -u root -p

# æ›´æ–°æœåŠ¡
docker-compose pull
docker-compose up -d --force-recreate

# æ¸…ç†èµ„æº
docker-compose down -v  # åˆ é™¤å·
docker system prune -a  # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
```

### æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status ai-agents-backend

# é‡å¯æœåŠ¡
sudo systemctl restart ai-agents-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u ai-agents-backend -f

# é‡è½½Nginxé…ç½®
sudo nginx -t && sudo systemctl reload nginx
```

## ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨æ—¥å¿—

- åç«¯æ—¥å¿—ï¼š`logs/app.log`
- Nginxæ—¥å¿—ï¼š`/var/log/nginx/`
- MySQLæ—¥å¿—ï¼š`/var/log/mysql/`

### 2. å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥åç«¯æœåŠ¡
curl http://localhost:8080/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker-compose exec mysql mysql -u aiuser -p ai_agents -e "SELECT 1"
```

### 3. æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
   - éªŒè¯é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
   - ç¡®è®¤é˜²ç«å¢™è®¾ç½®

2. **ç«¯å£å†²çª**
   - ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®
   - æ£€æŸ¥ç«¯å£å ç”¨ï¼š`netstat -tlnp | grep :8080`

3. **æƒé™é—®é¢˜**
   - ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®ï¼š`chown -R www-data:www-data /opt/ai-agents`
   - æ£€æŸ¥SELinuxè®¾ç½®ï¼ˆå¦‚é€‚ç”¨ï¼‰

4. **å†…å­˜ä¸è¶³**
   - å¢åŠ æœåŠ¡å™¨å†…å­˜
   - è°ƒæ•´MySQLé…ç½®å‚æ•°

### æ—¥å¿—æŸ¥çœ‹

```bash
# Dockerå®¹å™¨æ—¥å¿—
docker-compose logs backend
docker-compose logs mysql
docker-compose logs frontend

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u ai-agents-backend
sudo tail -f /var/log/nginx/error.log
```

## å®‰å…¨å»ºè®®

1. **æ•°æ®åº“å®‰å…¨**
   - ä½¿ç”¨å¼ºå¯†ç 
   - é™åˆ¶æ•°æ®åº“è®¿é—®IP
   - å®šæœŸå¤‡ä»½æ•°æ®

2. **ç½‘ç»œå®‰å…¨**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - ä½¿ç”¨HTTPSï¼ˆé…ç½®SSLè¯ä¹¦ï¼‰
   - é™åˆ¶ä¸å¿…è¦çš„ç«¯å£æš´éœ²

3. **åº”ç”¨å®‰å…¨**
   - å®šæœŸæ›´æ–°ä¾èµ–åŒ…
   - é…ç½®é€‚å½“çš„æ—¥å¿—çº§åˆ«
   - å®æ–½è®¿é—®æ§åˆ¶

## å¤‡ä»½å’Œæ¢å¤

### æ•°æ®å¤‡ä»½

```bash
# æ•°æ®åº“å¤‡ä»½
docker-compose exec mysql mysqldump -u root -p ai_agents > backup_$(date +%Y%m%d).sql

# å®Œæ•´å¤‡ä»½
tar -czf ai-agents-backup-$(date +%Y%m%d).tar.gz /opt/ai-agents
```

### æ•°æ®æ¢å¤

```bash
# æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p ai_agents < backup_20240101.sql

# æ¢å¤åº”ç”¨
tar -xzf ai-agents-backup-20240101.tar.gz -C /opt/
```

## æ›´æ–°å‡çº§

### åº”ç”¨æ›´æ–°

```bash
# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp -r /opt/ai-agents /opt/ai-agents-backup-$(date +%Y%m%d)

# 2. æ›´æ–°ä»£ç 
git pull origin main

# 3. é‡æ–°æ„å»ºå’Œéƒ¨ç½²
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# 4. éªŒè¯æ›´æ–°
docker-compose ps
curl http://localhost:8080/health
```

## ä½¿ç”¨è¯´æ˜

### åˆ›å»ºæ™ºèƒ½ä½“
1. ç‚¹å‡»"åˆ›å»ºæ™ºèƒ½ä½“"æŒ‰é’®
2. å¡«å†™æ™ºèƒ½ä½“åç§°ã€è§’è‰²å’Œæ€§æ ¼æè¿°
3. ç‚¹å‡»"åˆ›å»º"å®Œæˆæ™ºèƒ½ä½“åˆ›å»º

### åˆ›å»ºèŠå¤©å®¤
1. ç‚¹å‡»"åˆ›å»ºåœ†æ¡Œ"æŒ‰é’®
2. è¾“å…¥è®¨è®ºä¸»é¢˜
3. é€‰æ‹©å‚ä¸è®¨è®ºçš„æ™ºèƒ½ä½“ï¼ˆè‡³å°‘2ä¸ªï¼‰
4. ç‚¹å‡»"å¼€å§‹è®¨è®º"å¯åŠ¨è‡ªåŠ¨åŒ–å¯¹è¯

### è§‚å¯Ÿè®¨è®º
- æ™ºèƒ½ä½“ä¼šè‡ªåŠ¨è¿›è¡Œè®¨è®º
- æ¶ˆæ¯ä¼šå®æ—¶æ˜¾ç¤ºåœ¨èŠå¤©çª—å£ä¸­
- å¯ä»¥éšæ—¶åœæ­¢è®¨è®º

## APIæ–‡æ¡£

### æ™ºèƒ½ä½“ç›¸å…³æ¥å£

- `GET /agents` - è·å–æ‰€æœ‰æ™ºèƒ½ä½“
- `POST /agents` - åˆ›å»ºæ–°æ™ºèƒ½ä½“
- `DELETE /agents/:id` - åˆ é™¤æ™ºèƒ½ä½“

### èŠå¤©å®¤ç›¸å…³æ¥å£

- `GET /chatrooms` - è·å–æ‰€æœ‰èŠå¤©å®¤
- `POST /chatrooms` - åˆ›å»ºæ–°èŠå¤©å®¤
- `POST /chatrooms/:id/start` - å¼€å§‹è®¨è®º
- `POST /chatrooms/:id/stop` - åœæ­¢è®¨è®º

### WebSocketæ¥å£

- `WS /ws` - WebSocketè¿æ¥ï¼Œç”¨äºå®æ—¶æ¶ˆæ¯æ¨é€

## è”ç³»æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- Dockerå’ŒDocker Composeç‰ˆæœ¬
- é”™è¯¯æ—¥å¿—
- é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰

---

**æ³¨æ„**: è¯·æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´é…ç½®å‚æ•°ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨å’Œç¨³å®šè¿è¡Œã€‚